
# Registro de Errores y Soluciones

Este documento registra los errores encontrados durante el desarrollo de la aplicación CalReact, sus causas probables o confirmadas, y las soluciones aplicadas o notas relevantes.

| Error (Resumen o Mensaje Clave) | Causa Probable/Confirmada                                                                 | Solución Aplicada / Notas                                                                                                                               | Fecha (Opcional) |
| ------------------------------- | ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------- |
| **1 Error de Parseo JSX en `settings/page.tsx`** (Ej: `Unexpected token div. Expected jsx identifier`) | Error de sintaxis en el código JavaScript/TypeScript que precede al bloque `return (...)` del componente. Usualmente una llave `}` o paréntesis `)` faltante o mal cerrado en las funciones de importación o `useEffect`. | Revisar y corregir la sintaxis de las funciones (ej. `handleImportClients`, `handleImportProjects`, `handleImportPayments`) asegurando que todos los bloques de código estén correctamente cerrados. Reemplazar el archivo con una versión corregida. | 2024-07-29       |
| **2 Error al importar proyectos: "Proyecto 'Desconocido' omitido: faltan campos obligatorios..."** | El archivo JSON de importación contiene objetos de proyecto que no cumplen con los campos requeridos (`projectNumber`, `clientId`, `date`, `subtotal`, `taxRate`, `status`, `collect`) o sus valores son inválidos/vacíos. Puede incluir objetos JSON completamente vacíos (`{}`). | Revisar el contenido del archivo JSON para asegurar que cada objeto de proyecto tenga todos los campos obligatorios con datos y formatos válidos. Corregir o eliminar los objetos de proyecto inválidos del JSON. | 2024-07-29       |
| **3 `DialogContent` requiere `DialogTitle` o `DialogDescription` para accesibilidad** (Advertencia de Radix UI) | Los componentes de diálogo (`ClientModal`, `ProjectModal`, `EventModal`) no incluían `DialogTitle` (si aplica) y `DialogDescription` para proveer contexto a usuarios de lectores de pantalla. | Añadir `DialogTitle` (si faltaba) y `DialogDescription` a cada `DialogHeader` en los componentes de modal afectados para cumplir con las pautas de accesibilidad. | 2024-07-29       |
| **4 `No QueryClient set, use QueryClientProvider to set one`** | El componente que llama a `useQueryClient()` (ej. `ProjectsPage`) se renderiza antes de que `QueryClientProvider` esté disponible en el árbol de React. Esto ocurría porque `QueryClientProvider` se renderizaba condicionalmente basado en un estado (`isClient`/`isMounted`) que se actualizaba después del primer render. | Asegurar que `QueryClientProvider` envuelva a los `children` de manera consistente en `src/app/layout.tsx` durante el renderizado del cliente, idealmente mostrando un estado de carga hasta que todos los proveedores del lado del cliente estén listos. | 2024-07-28       |
| **5 `useSidebar must be used within a SidebarProvider`** | Similar al error de `QueryClient`, el `SidebarTrigger` (u otro componente que use `useSidebar`) se renderizaba antes de que `SidebarProvider` estuviera en el árbol de React, debido a la renderización condicional en `layout.tsx`. | Asegurar que `SidebarProvider` envuelva a los `children` de manera consistente en `src/app/layout.tsx` durante el renderizado del cliente, como se hizo con `QueryClientProvider`. | 2024-07-28       |
| **6`Module not found: Can't resolve '@/components/ui/command'`** | El archivo `src/components/ui/command.tsx` no existía en el proyecto, pero era importado por componentes como el Combobox en `projects/new/page.tsx`. | Crear el archivo `src/components/ui/command.tsx` con la implementación estándar del componente `Command` de ShadCN/UI. | 2024-07-28       |
| **7 Errores de conexión con Firebase (403, 404)** al iniciar la app. | Problemas con la configuración del proyecto Firebase (servicios no habilitados, API key incorrecta, `projectId` incorrecto en `.env`) o reglas de seguridad de Firestore/App Hosting muy restrictivas. Interferencia de extensiones de navegador. | Verificar la configuración del proyecto Firebase en la consola, las variables de entorno en `.env` y las reglas de seguridad. Probar deshabilitando extensiones del navegador. | 2024-07-28       |
| **8 Hydration failed because the server rendered HTML didn't match the client.** (Traducción automática, etc.) | Una extensión del navegador (como un traductor automático) modificó el HTML después del renderizado del servidor y antes de la hidratación del cliente. También puede ser por uso de `new Date()` o `Math.random()` de forma que produzca resultados distintos en servidor y cliente. | Revisar extensiones del navegador. Para `new Date()`, asegurar que los componentes dependientes de la fecha actual se rendericen solo después del montaje en el cliente (usando `useEffect` y un estado `isClient`). | 2024-07-28       |
| **9 Error al importar Pagos: `Function setDoc() called with invalid data. Unsupported field value: undefined (found in field notes ...)`** | Se intentó guardar un documento en Firestore (colección `payments`) donde uno o más campos opcionales (como `notes`, `amount`, `paymentMethod`, `paymentType`, `installments`) tenían el valor `undefined`. Firestore no permite guardar valores `undefined`. Esto ocurre si el JSON de importación omite estos campos y la lógica de preparación de datos los asigna como `undefined` en lugar de omitirlos del objeto final o asignarles `null`. | Modificar el servicio `paymentService.ts` (función `addPayment`) para que, al construir el objeto a guardar en Firestore, los campos opcionales que sean `undefined` se omitan por completo del objeto. De esta manera, Firestore no intentará escribir un campo con valor `undefined`. | 2024-07-30       |

<!-- Añade nuevas entradas aquí a medida que surjan -->
